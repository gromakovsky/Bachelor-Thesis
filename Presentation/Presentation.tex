\documentclass[russian, hyperref={unicode}]{beamer}

\usetheme{Madrid}
\setbeamertemplate{footline}[frame number]
\setbeamertemplate{navigation symbols}{}

\usepackage[T2A]{fontenc}
\usepackage{lmodern}
\usepackage[utf8x]{inputenc}
\usepackage[english, russian]{babel}
\usepackage{graphicx}

\theoremstyle{definition}
\newtheorem{rudefinition}{Определение}

\graphicspath{ {../Images/} }

% workaroung warning
\let\Tiny=\tiny

\title{Построение семейств оптимальных маршрутов на морских картах}
\author{Иван Громаковский \\
Научный руководитель: А. С. Ковалев}
\institute{Санкт-Петербургский национальный исследовательский университет \\ информационных технологий, механики и оптики}
\date{}

\begin{document}

\section{Введение}

\frame{\titlepage}
\note{Здравствуйте!}

\subsection{Описание задачи}

\begin{frame}{Цели работы}
    \begin{itemize}
        \item Исследование проблемы поиска семейств маршрутов по воде
        \item Формализация понятия семейства оптимальных маршрутов
        \item Разработка и реализация алгоритма для работы в режиме реального времени
    \end{itemize}
\end{frame}
\note {
1. Глобально задача заключается в исследовании проблемы поиска
семейств (то есть множеств) маршрутов между двумя точками по воде.
2. При этом хочется находить не какие попало машруты, а в некотором
смысле оптимальные, поэтому первоочередная задача состоит в
формализации критерия оптимальности.
3. Результатом работы должен стать реализованный алгоритм, работающий
в реальном времени. TODO: тут объяснить, зачем real-time
}

\begin{frame}{Актуальность задачи}
    Проблемы поиска единственного маршрута:
    \begin{itemize}[<+->]
        \item критерии оптимальности не всегда очевидны и формализуемы
        \item ненадёжность
     %   \item приводит к повышенной загруженности
    \end{itemize}
    \uncover<3>{Неизвестны алгоритмы multipath planning на воде}
\end{frame}
\note {
Задача поиска кратчайшего маршрута при наличии полигональных
препятствий хорошо известна и исследована, однако при таком подходе
возникают следующие проблемы:
1. Кратчайший путь (по какой-либо метрике) не всегда оптимален, а
реальные критерии оптимальности могут быть не очевидны и трудно
формализуемы (например, стоимость прохода через канал, личные
предпочтения капитана).
% Например, где-то может быть
% платный проезд, также нужно учитывать глубину, загруженность. Также у
% капитана могут быть личные предпочтения, которые невозможно
% формализовать.
2. Если по каким-то причинам проплыть по кратчайшему маршруту не
представляется возможным (проходят учения/информация устарела/etc.),
то возникает проблема, потому что нет альтернатив.
% 3. Если приложение набирает популярность и все пользуются одинаковыми
% (например, кратчайшими) маршрутами, это может приводить повышенной загруженности.
}
        
\subsection{Существующие решения}

\begin{frame}{Существующие алгоритмы}
    \only<1> {
    Известные алгоритмы multipath planning:
    \begin{itemize}
        \item разрабатывались для других целей
        \item не учитывают реальное физическое расположение
          вершин в графе
        \item строят очень похожие маршруты на морских картах
    \end{itemize}
    }
    \only<2> {
        \begin{figure}
            \includegraphics[width=.95\textwidth]{comparison-with-existing-bad}

            Результат работы известного алгоритма
        \end{figure}
    }
    \only<3> {
        \begin{figure}
            \includegraphics[width=.95\textwidth]{comparison-with-existing-good}

            Желаемый результат
        \end{figure}
    }
\end{frame}
\note {
Известны различные алгоритмы поиска нескольких путей в графе. Однако все они не годятся для данной задачи.
Разрабатывались для других целей: например, поиск маршрутов по дорогам, поиск маршрутов на общественном транспорте, когда есть несколько способов добраться из точки А в точку Б. 
Не учитывают расположение: эти алгоритмы в большинстве своём оперируют абстрактными графами, не привязанными к конкретным координатам в мире.
Похожие маршруты: как следствие, попытка применить эти алгоритмы к данной задаче приводит к похожим маршрутам (хоть и почти не имеющим общих точек).
}

\section{Решение}

\subsection{Формализация}

\begin{frame}{Оптимальность маршрутов}
  \begin{rudefinition}
    Назовём семейством оптимальных маршрутов из одной точки в другую
    максимальное по включению множество путей между этими точками,
    обладающее следующими свойствами:
    \begin{itemize}
        \item для любых двух маршрутов найдётся препятствие, обход
          которого происходит с разных сторон
        \item отношение диаметра такого препятствия к длине
          кратчайшего из двух маршрутов больше наперёд заданной константы
        \item TODO: слайд не совсем готов, нужно будет
          подкорректировать определение
    \end{itemize}
  \end{rudefinition}
\end{frame}
\note{Слайд не готов}

\subsection{Предобработка и простой поиск}

\begin{frame}{Предобработка данных}
    \begin{itemize}
        \item Карта → полигон
        \item Смещение полигона внутрь
        \item Граф по сетке на плоскости + граф локальной видимости
        \item Ограничение длины ребра
        \item Дополнительные рёбра
    \end{itemize}
\end{frame}
\note {
1. Склеивание, упрощение. Полигон — множество контуров (в том числе дырок).
2. Корабли не плавают слишком близко к суше. Используется straight skeleton.
3. Чтобы находить кратчайший путь, нужен граф видимости. Но в нём
слишком много рёбер, поэтому построим навигационный граф. Разложим
вершины по сетке, проведём рёбра до соседей (и их соседей). Также
добавим вершины полигона и проведём из них рёбра до ближайших видимых 
вершин. Веса рёбер — расстояния между точками на сфере.
4. Путь ищется на сфере, при этом проверка корректности рёбер
осуществляется на плоскости. Кратчайшая траектория на сфере отличается
от кратчайшей траектории на плоскости. Не будем допускать слишком
длинные рёбра, тогда расхождение будет пренебрежимо мало.
5. Во-первых, добавим рёбра из straight skeleton'а, получившиеся в
результате схлопывания. Во-вторых, нужна возможность добавления рёбер
в связи с неточностями исходной карты. В-третьих, рёбра через 180-ый меридиан.

P. S. Возможно, будет выпилено или объединено.
}

\begin{frame}{Поиск одного маршрута}
    \only<1-4> {
        \begin{itemize}
            \item<1-4> Добавление вершин в граф
            \item<2-4> Алгоритм Дейкстры
            \item<3-4> Сокращение маршрута
            \begin{itemize}
                \item<3-4> Если подпуть A → B → C можно выгодно заменить на A → C, заменяем 
                \item<3-4> Подразбиение маршрута
            \end{itemize}
            \item<4-4> Сглаживание маршрута
        \end{itemize}
    }
    \only<5> {
        \begin{figure}
            \includegraphics[width=\textwidth]{shortcut-and-smoothing}
            
            Сокращение и сглаживание
        \end{figure}
    }
\end{frame}
\note {
Добавление вершин: проверяем, принадлежит ли воде. Добавляем вершину в граф. По сетке находим ближайшие вершины и добавляем к ним рёбра.
Сокращение маршрута: кратчайший путь в навигационном графе не обязан быть действительно кратчайшим путём. Обычно его можно сократить.
Сглаживание: избавление от очень острых углов, если это возможно (маршрут остаётся на воде). Из-за структуры графа могут возникать острые углы (резкие повороты). Реальные маршруты не такие.
}

\subsection{Поиск нескольких маршрутов}

\begin{frame}{Поиск нескольких маршрутов}
    \begin{itemize}
        \item Поиск одного маршрута
          \pause
        \item Обновление весов:
        \begin{itemize}
            \item Потенциалы как функция кратчайших расстояний от фиктивной вершины
            \item Обновление потенциалов
            \item Применение потенциалов
        \end{itemize}
          \pause
        \item Проверка критерия остановки:
        \begin{itemize}
            \item Длина маршрута
            \item Метрики на маршрутах
        \end{itemize}
    \end{itemize}
\end{frame}
\note {
На этом слайде описана общая идея алгоритма.

Поиск одного маршрута: как сказано на прошлом слайде.

Обновление весов:

— из фиктивной вершины проводим рёбра нулевого веса во все вершины
пути. Запускаем алгоритм Дейкстры из фиктивной вершины, находим все
кратчайшие расстояния. Потенциал — эвристическая функция найденного
кратчайшего расстояния, определённая для каждой вершины. Чем больше
потенциал, тем сильнее нужно увеличить веса инцедентных вершине рёбер.

— обновление потенциалов (максимум/сумма/произведение/что-то ещё). Об этом ещё скажу.

— обновление весов рёбер — модификация весов в соответствии с
потенциалами. Об этом тоже скажу.

Критерий остановки: определяем, хороший ли маршрут. Если хороший, то переходим к следующей итерации, иначе прекращаем.

— длина: если сильно длинее кратчайшего, то плохой.

— метрики: оцениваем похожесть на другие маршруты. Если есть похожий, то плохо.
}

\begin{frame}{Обновление весов}
    \only<1> {
        \begin{figure}
            \includegraphics[width=\textwidth]{potentials-multipliers}

            Потенциалы должны быть множителями, а не слагаемыми
        \end{figure}
    }
 
    \only<2> {
        \begin{columns}
            \column{.5\textwidth}
            \begin{figure}
                \includegraphics[clip=true, trim = 280pt 0 20pt 0, width=\textwidth]{potentials-update/accum1}
            \end{figure}

            \column{.5\textwidth}
            \begin{figure}
                \includegraphics[clip=true, trim = 280pt 0 20pt 0, width=\textwidth]{potentials-update/max1}
            \end{figure}
        \end{columns}

        \begin{center}
            При обновлении потенциалов следует брать максимум.
        \end{center}
    }
   
    \only<3> {
        \begin{columns}
            \column{.5\textwidth}
            \begin{figure}
                \includegraphics[clip=true, trim = 280pt 0 20pt 0, width=\textwidth]{potentials-update/accum2}
            \end{figure}

            \column{.5\textwidth}
            \begin{figure}
                \includegraphics[clip=true, trim = 280pt 0 20pt 0, width=\textwidth]{potentials-update/max2}
            \end{figure}
        \end{columns}

        \begin{center}
            При обновлении потенциалов следует брать максимум.
        \end{center}
    }
   
    \only<4> {
        \begin{columns}
            \column{.5\textwidth}
            \begin{figure}
                \includegraphics[clip=true, trim = 280pt 0 20pt 0, width=\textwidth]{potentials-update/accum3}
            \end{figure}

            \column{.5\textwidth}
            \begin{figure}
                \includegraphics[clip=true, trim = 280pt 0 20pt 0, width=\textwidth]{potentials-update/max3}
            \end{figure}
        \end{columns}
        
        \begin{center}
            При обновлении потенциалов следует брать максимум.
        \end{center}
    }
   
    \only<5> {
        \begin{columns}
            \column{.5\textwidth}
            \begin{figure}
                \includegraphics[clip=true, trim = 280pt 0 20pt 0, width=\textwidth]{potentials-update/accum4}
            \end{figure}

            \column{.5\textwidth}
            \begin{figure}
                \includegraphics[clip=true, trim = 280pt 0 20pt 0, width=\textwidth]{potentials-update/max4}
            \end{figure}
        \end{columns}
        
        \begin{center}
            При обновлении потенциалов следует брать максимум.
        \end{center}
    }
   
    \only<6> {
        \begin{columns}
            \column{.5\textwidth}
            \begin{figure}
                \includegraphics[clip=true, trim = 280pt 0 20pt 0, width=\textwidth]{potentials-update/accum_result}
            \end{figure}

            \column{.5\textwidth}
            \begin{figure}
                \includegraphics[clip=true, trim = 280pt 0 20pt 0, width=\textwidth]{potentials-update/max_result}
            \end{figure}
        \end{columns}
        
        \begin{center}
            При обновлении потенциалов следует брать максимум.
        \end{center}
    }
   
    \only<7> {
        \begin{figure}
          \begin{columns}
            \column{.5\textwidth}
            \includegraphics[clip=true, trim = 300pt 20pt 330pt 350pt, width=\textwidth]{weights-on-path-bad}

            \column{.5\textwidth}
            \includegraphics[clip=true, trim = 300pt 20pt 330pt 350pt, width=\textwidth]{weights-on-path-good}
          \end{columns}

            На маршруте потенциалы меньше, чем поблизости
        \end{figure}
    }
\end{frame}
\note {
1. Рассмотрим такую ситуацию, вершины находятся довольно близко,
поэтому их потенциалы примерно равны какому-то C. При этом, если
прибавлять среднее арифметическое, то стоимость верхнего пути
получится на C больше, хотя он лучше. Поэтому будем домножать на
среднее геометрическое.

2. Слева показана ситуация, где потенциалы аккумулируются, а справа —
где берётся максимум. Во первом случае почти весь вклад потенциалов
сосредоточен в начале и конце. В результате во втором случае найдено
на один маршрут больше.

3. На маршруте получаются самые большие потенциалы, из-за чего
следующие маршруты могут незначительно отличаться в местах, где они
ожидаются такими же. Для получения более естественного результата
сделаем потенциалы на маршруте чуть меньше, чем поблизости.
}

\begin{frame}{Метрики}
    \only<1-1> {
        \begin{equation*}
%        \begin{split}
            \rho_1 (P, Q) = \max(\max_{u \in P} \min_{v \in Q} \rho_g(u,
            v), \max_{u \in Q} \min_{v \in P} \rho_g(u, v))
%        \end{split}
        \end{equation*}
        \begin{figure}
            \includegraphics[width=\textwidth]{hg-definitely-similar}
        \end{figure}
    }
    \only<2-2> {
        \begin{equation*}
%        \begin{split}
            \rho_2 (P, Q) = \max(\max_{u \in P} \frac{\min\limits_{v \in Q_u}
            \rho_g(u, v)}{\min\limits_{v \in Q_u} \rho_r(u, v)}, \max\limits_{u \in Q} \frac{\min\limits_{v \in P_u}
            \rho_g(u, v)}{\min\limits_{v \in P_u} \rho_r(u, v)})
%        \end{split}
        \end{equation*}
        \begin{equation*}
            Q_u = \{ v : \rho_r(u, v) > \varepsilon \}
        \end{equation*}
        \begin{figure}
            \includegraphics[width=.85\textwidth]{hg-maybe-similar}
        \end{figure}
    }
\end{frame}
\note {
Первая метрика: основная метрика для оценки похожести маршрутов. Если
значение очень большое (относительно длины маршрута), то маршруты
точно непохожи. Если значение очень маленькое, то маршруты точно
похожи. Иначе считаем, что значения этой метрики недостаточно.
Вторая метрика: дополнительная метрика. Нужна, чтобы различать
ситуации, когда мы обошли остров и когда между маршрутами просто так
получилось большое расстояние в смысле первой метрики.
}

\begin{frame}{Вычисление метрик}
    \begin{itemize}
        \item Фиктивная вершина
        \item Обход Дейкстры, пока не посещены вершины второго пути 
        \item Заканчиваем, если достигли необходимого значения
        \item Поиск ближайшей вершины (вторая метрика) — перебором
        \item На практике затраты как на первую, так и на вторую
          метрику небольшие
    \end{itemize}
\end{frame}

\section{Результаты}

\begin{frame}{Результаты}
    \only<1-1> {
        \begin{itemize}
            \item Разработан и реализован алгоритм построения семейств оптимальных маршрутов 
            \item Проведено сравнение с существующими подходами 
            \item Поиск выполняется примерно за полсекунды 
            \item Используется в 3D-клиенте ЗАО «Кронштадт Технологии»
        \end{itemize}
    }
    \only<2-2> {
        \begin{figure}
            \includegraphics[width=\textwidth]{results}
        \end{figure}
    }
\end{frame}

\begin{frame}{Спасибо за внимание!}
    \begin{center}
        \Huge
        {\color{blue} Вопросы?}
    \end{center}
\end{frame}
\note{До свидания!}

\end{document}

